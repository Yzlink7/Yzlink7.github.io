<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App</title>
  <link rel="stylesheet" href="onsenui.css">
  <link rel="stylesheet" href="onsen-css-components.css">
  <style>
    ons-page {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #chat-container {
      max-width: 400px;
      width: 100%;
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #chat-output {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ccc;
    }

    ons-input {
      width: 70%;
      margin-right: 5px;
      box-sizing: border-box;
    }

    ons-button {
      width: 28%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<ons-page>
  <div id="chat-container">
    <div id="chat-output"></div>
    <ons-input id="nama" placeholder="Masukkan pesan anda"></ons-input>
    <ons-button id="buttonid" onclick="kirimPesan()">Kirim</ons-button>
    <ons-button id="buttonid2" onclick="reloadWebSocket()">Reload</ons-button>
   <ons-button id="buttonid27" onclick="reloadWebSocket2()">Reload</ons-button>
  </div>

<script src="socket.io.min.js"></script>
<script src="jquery-3.3.1.slim.min.js"></script>
<script src="sweetalert.js"></script>
<script src="onsenui.js"></script>

<script>
var button7 = document.getElementById('buttonid');
var input7 = document.getElementById("nama");
var chat7 = document.getElementById("chat-output");
  const chatOutput = document.getElementById("chat-output");
  const inputNama = document.getElementById("nama");
  let ipAddress;
var buttonid2 = document.getElementById('buttonid2');
var buttonid27 = document.getElementById("buttonid27");
buttonid27.style.display = 'none';
buttonid27.disabled = true;
var kay = "oke";
function reloadWebSocket() {
  ws.close();
 buttonid27.style.display = 'block';
buttonid27.disabled = false;
input7.style.display = 'none';
 input7.disabled = true; 
 button7.style.display = 'none';
  button7.disabled = true; 
 buttonid2.style.display = 'none';
  buttonid2.disabled = true; 
  chat7.style.display = 'none'; 
  chat7.disabled = true; 
  buttonid27.style.position = 'absolute'; 
  buttonid27.style.left = '50%';
   buttonid27.style.top = '50%';
    buttonid27.style.transform = 'translate(-50%, -50%)';
}
function reloadWebSocket2() {
  location.reload();
}

 // const ws = new BroadcastChannel("kangwifi-ws");

const ws = new WebSocket("wss://s12628.sgp1.piesocket.com/v3/1?api_key=jG8aBEWEeQzNejV0jvd01tSR7WDR9KCmf5qUM9WG&notify_self=1");
 ws.onopen = () => {
kay = "oke";
};
  
  
 ws.onmessage = (event) => {
  const pesan = document.createElement("p");
  pesan.textContent = event.data;
  chatOutput.appendChild(pesan);
  console.log(event.data);

  

  if ((event.data === "reload" || event.data === ipAddress) && kay === "oke") {
    Swal.fire({
      title: 'Reload Confirmation',
      text: 'Are you sure you want to reload?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, reload!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if (result.isConfirmed) {
        ws.close();
        location.reload();
      }
    });
  }

  if (event.data === "yt.open" && kay === "oke") {
    Swal.fire({
      title: 'Open YouTube Confirmation',
      text: 'Are you sure you want to open YouTube?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, open!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if (result.isConfirmed) {
        ws.close();
        window.location = 'https://yt.kangwifi.eu.org';
      }
    });
  }

  if (event.data === "alquran.open" && kay === "oke") {
    Swal.fire({
      title: 'Open Alquran Confirmation',
      text: 'Are you sure you want to open Alquran?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, open!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if (result.isConfirmed) {
        ws.close();
        window.location = 'https://alquran.kangwifi.eu.org';
      }
    });
  }

  if (event.data === "cuaca.open" && kay === "oke") {
    Swal.fire({
      title: 'Open Weather Confirmation',
      text: 'Are you sure you want to open Weather?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, open!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if (result.isConfirmed) {
        ws.close();
        window.location = 'https://yt.kangwifi.eu.org/Weather';
      }
    });
  }

  if (event.data === "ttt.open" && kay === "oke") {
    Swal.fire({
      title: 'Open Tic Tac Toe Confirmation',
      text: 'Are you sure you want to open Tic Tac Toe?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, open!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if(result.isConfirmed) {
        ws.close();
        window.location = 'https://yt.kangwifi.eu.org/ttt';
      }
    });
  }

  if (event.data === "xnxx.open" && kay === "oke") {
    Swal.fire({
      title: 'Open XNXX Confirmation',
      text: 'Are you sure you want to open XNXX?',
      icon: 'nama',
      showCancelButton: true,
      confirmButtonText: 'Yes, open!',
      cancelButtonText: 'Cancel',
    }).then((result) => {
      if (result.isConfirmed) {
        ws.close();
        window.location = 'https://xnxx.com';
      }
    });
  }

  // Add more conditions as needed
};
  
async function kirimPesan() {
  const nama = inputNama.value;
  const pesan = nama.toLowerCase();
  if (pesan.includes(".bot")) {
    const cseKey = "AIzaSyDcfgD-T2yfibxBOVH5k9mVjy5kd2e38Xo";
    const cseId = "75b87346bbf744e47";
    const query = encodeURIComponent(nama.substring(4));
    const url = `https://www.googleapis.com/customsearch/v1?key=${cseKey}&cx=${cseId}&q=${query}`;
    
    try {
      const response = await fetch(url);
      const data = await response.json();
      const answer = data.items[0].snippet;
      ws.send(answer);
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  }

  if (nama.trim() !== "") {
    if (kay !== "nooke" && (pesan.includes("reload") || pesan.includes("yt.open") || pesan.includes("alquran.open") || pesan.includes("cuaca.open") || pesan.includes("ttt.open") || pesan.includes("xnxx.open"))) {
      Swal.fire({
        icon: "warning",
        title: "Pesan diblokir!",
        text: "Certain keywords are not allowed in the message.",
      });
      inputNama.value = "";
    } else {
 if (!pesan.includes("root")) {
 if (!pesan.includes(".bot")) {
          ws.send(nama);
        Swal.fire({
          icon: "success",
          title: "Pesan terkirim!",
          text: "Success",
        });
        inputNama.value = "";
        } else {
        Swal.fire({
          icon: "success",
          title: "BOT!",
          text: "PERTANYAN ANDA DIJAWAB OLEH BOT!",
        });
        inputNama.value = ".bot ";
      }
      } else {
        Swal.fire({
          icon: "success",
          title: "Admin!",
          text: "Anda adalah admin!",
        });
        kay = "nooke";
        inputNama.value = "";
      }
    }
  } else {
    Swal.fire({
      icon: "warning",
      title: "Pesan kosong!",
      text: "Mohon masukkan pesan Anda.",
    });
  }
}

ws.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
reloadWebSocket();
   } else {
   alert('[close] Connection died');
   reloadWebSocket();
  }
};

ws.onerror = function(error) {
  alert(`[error]`);
  reloadWebSocket();
};
</script>

</body>
</html>
